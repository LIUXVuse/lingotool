(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function o(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=o(a);fetch(a.href,r)}})();function t(e){const n=document.getElementById("debug-info"),o=new Date().toLocaleTimeString();n.innerHTML+=`<div>[${o}] ${e}</div>`,console.log(e)}const B={apiKey:"AIzaSyAI0z9Kx0qpaL8qMLN5SYmsUFS2YzkvyqM",authDomain:"v3-translate-3e45b.firebaseapp.com",projectId:"v3-translate-3e45b",storageBucket:"v3-translate-3e45b.firebasestorage.app",messagingSenderId:"486783172411",appId:"1:486783172411:web:0d285560821dea449e011e"};let c=null,g=null;const A=["apiKey","authDomain","projectId","appId"];let m=[];for(const e of A)if(!B[e]){const n=`VITE_FIREBASE_${e.replace(/([A-Z])/g,"_$1").toUpperCase()}`;m.push(n)}if(m.length>0){const e=`Firebase 配置缺失: ${m.join(", ")}。請檢查 Cloudflare 環境變數。`;console.error(e),t(`錯誤: ${e}`),alert("Firebase 配置錯誤，部分功能可能無法使用。請聯繫管理員。")}else try{firebase.initializeApp(B),c=firebase.auth(),g=firebase.firestore(),t("Firebase 初始化成功")}catch(e){console.error("Firebase 初始化失敗:",e),t(`Firebase 初始化失敗: ${e.message}`),alert("無法連接到 Firebase，請稍後再試。")}let d=null;document.addEventListener("DOMContentLoaded",function(){t("頁面已加載");try{document.getElementById("translateBtn").addEventListener("click",function(){t("翻譯按鈕被點擊"),x()}),t("翻譯按鈕事件已綁定")}catch(e){t(`綁定翻譯按鈕錯誤: ${e}`),console.error("綁定翻譯按鈕錯誤:",e)}try{document.getElementById("enlargeBtn").addEventListener("click",K),document.getElementById("shrinkBtn").addEventListener("click",N),t("放大/縮小按鈕事件已綁定")}catch(e){t(`綁定放大/縮小按鈕錯誤: ${e}`),console.error("綁定放大/縮小按鈕錯誤:",e)}try{document.getElementById("loginBtn").addEventListener("click",E),document.getElementById("logoutBtn").addEventListener("click",C),t("登入/登出按鈕事件已綁定")}catch(e){t(`綁定登入/登出按鈕錯誤: ${e}`),console.error("綁定登入/登出按鈕錯誤:",e)}try{document.getElementById("closeLoginModal").addEventListener("click",y),document.getElementById("googleLoginBtn").addEventListener("click",k),document.getElementById("emailLoginBtn").addEventListener("click",w),document.getElementById("showSignupBtn").addEventListener("click",b),t("登入模態窗事件已綁定")}catch(e){t(`綁定登入模態窗錯誤: ${e}`),console.error("綁定登入模態窗錯誤:",e)}try{document.getElementById("closeSignupModal").addEventListener("click",v),document.getElementById("emailSignupBtn").addEventListener("click",S),document.getElementById("showLoginBtn").addEventListener("click",E),t("註冊模態窗事件已綁定")}catch(e){t(`綁定註冊模態窗錯誤: ${e}`),console.error("綁定註冊模態窗錯誤:",e)}try{const e=document.getElementById("addPhraseBtn"),n=document.getElementById("cancelAddPhrase"),o=document.getElementById("savePhrase");e?e.addEventListener("click",D):t("警告: 未找到 addPhraseBtn 元素"),n?n.addEventListener("click",L):t("警告: 未找到 cancelAddPhrase 元素"),o?o.addEventListener("click",_):t("警告: 未找到 savePhrase 元素"),t("片語功能事件已嘗試綁定")}catch(e){t(`綁定片語功能錯誤: ${e}`),console.error("綁定片語功能錯誤:",e)}if(c)try{t("嘗試綁定 onAuthStateChanged"),c.onAuthStateChanged(function(e){e?(d=e,t(`用戶登入: ${e.email}`),M(e),$()):(d=null,t("用戶未登入"),T())}),t("成功綁定 onAuthStateChanged")}catch(e){t(`綁定 onAuthStateChanged 錯誤: ${e}`),console.error("綁定 onAuthStateChanged 錯誤:",e)}else t("錯誤: Firebase Auth 未成功初始化，無法監聽認證狀態。");try{const e=document.getElementById("languageSwitcher");e?(e.addEventListener("click",function(){const n=document.getElementById("sourceLanguage"),o=document.getElementById("targetLanguage"),s=n.value,a=o.value;if(s==="auto"){alert("自動檢測語言無法切換，請先選擇特定語言");return}for(let r=0;r<n.options.length;r++)if(n.options[r].value===a){n.selectedIndex=r;break}for(let r=0;r<o.options.length;r++)if(o.options[r].value===s){o.selectedIndex=r;break}}),t("語言切換功能事件已綁定")):t("錯誤: 未找到 languageSwitcher 元素")}catch(e){t(`綁定語言切換錯誤: ${e}`),console.error("綁定語言切換錯誤:",e)}t("DOMContentLoaded 處理程序結束")});function E(){document.getElementById("loginModal").style.display="block",document.getElementById("signupModal").style.display="none"}function y(){document.getElementById("loginModal").style.display="none"}function b(){document.getElementById("signupModal").style.display="block",document.getElementById("loginModal").style.display="none"}function v(){document.getElementById("signupModal").style.display="none"}function k(){const e=new firebase.auth.GoogleAuthProvider;c.signInWithPopup(e).then(n=>{t("Google 登入成功"),y()}).catch(n=>{t(`Google 登入失敗: ${n.message}`),console.error("Google 登入錯誤詳情:",n),alert(`Google 登入失敗: ${n.code} - ${n.message}`)})}function w(){const e=document.getElementById("emailInput").value,n=document.getElementById("passwordInput").value;if(!e||!n){alert("請填寫電子郵件與密碼");return}c.signInWithEmailAndPassword(e,n).then(o=>{t("電子郵件登入成功"),y()}).catch(o=>{t(`電子郵件登入失敗: ${o.message}`),alert(`登入失敗: ${o.message}`)})}function S(){const e=document.getElementById("signupEmailInput").value,n=document.getElementById("signupPasswordInput").value,o=document.getElementById("confirmPasswordInput").value;if(!e||!n){alert("請填寫電子郵件與密碼");return}if(n!==o){alert("密碼與確認密碼不符");return}c.createUserWithEmailAndPassword(e,n).then(s=>{t("用戶註冊成功"),v()}).catch(s=>{t(`用戶註冊失敗: ${s.message}`),console.error("註冊錯誤詳情:",s),alert(`註冊失敗: ${s.code} - ${s.message}`)})}function C(){c.signOut().then(()=>{t("用戶登出成功")}).catch(e=>{t(`用戶登出失敗: ${e.message}`)})}function M(e){document.getElementById("userInfo").style.display="block",document.getElementById("userName").textContent=e.email,document.getElementById("loginBtn").style.display="none",document.getElementById("logoutBtn").style.display="inline-block",document.getElementById("phrasesContainer").style.display="block"}function T(){document.getElementById("userInfo").style.display="none",document.getElementById("userName").textContent="未登入",document.getElementById("loginBtn").style.display="inline-block",document.getElementById("logoutBtn").style.display="none",document.getElementById("phrasesContainer").style.display="none",document.getElementById("phrasesList").innerHTML=""}const O="deepseek/deepseek-chat-v3-0324:free";async function x(){try{t("開始翻譯流程");const e=document.getElementById("inputText").value,n=document.getElementById("sourceLanguage").value,o=document.getElementById("targetLanguage").value;if(t(`輸入文本: "${e}"`),t(`從 ${u(n)} 翻譯到 ${u(o)}`),!e.trim()){t("錯誤: 輸入為空"),alert("請先輸入要翻譯的文本");return}document.querySelector(".loading").style.display="block",document.getElementById("error-message").style.display="none",t("顯示加載動畫");try{t("調用 OpenRouter API");const s=await F(e,n,o);t(`翻譯結果: "${s}"`),document.getElementById("result").textContent=s,document.getElementById("largeText").textContent=s,t("更新UI完成")}catch(s){t(`OpenRouter API 錯誤: ${s.message}`),document.getElementById("error-message").style.display="block",document.getElementById("error-message").textContent=`翻譯過程中出現錯誤: ${s.message}`}finally{document.querySelector(".loading").style.display="none",t("隱藏加載動畫")}}catch(e){t(`發生全局錯誤: ${e.message}`),console.error("全局錯誤:",e),alert("發生錯誤: "+e.message)}}async function F(e,n,o){var h;let s;try{s=q()}catch(l){throw document.getElementById("error-message").style.display="block",document.getElementById("error-message").textContent=`獲取 API Key 時出錯: ${l.message}`,l}const a="https://openrouter.ai/api/v1/chat/completions";let r="你是一位專業的翻譯專家。請將以下文本進行精確翻譯，保持原文的意思、語氣和風格。只需返回翻譯結果，不要添加任何解釋或前言。",i="";n==="auto"?i=`將以下文本翻譯成${u(o)}：

${e}`:i=`將以下${u(n)}文本翻譯成${u(o)}：

${e}`,t("構建 API 請求");const p={model:O,messages:[{role:"system",content:r},{role:"user",content:i}],temperature:.1,max_tokens:2e3,top_p:.95,frequency_penalty:0};t(`API 請求詳情: ${JSON.stringify(p,null,2)}`);try{const l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,"X-Title":"LingoTool"},body:JSON.stringify(p)});if(!l.ok){const I=await l.json().catch(P=>({error:{message:`無法解析錯誤響應: ${P.message}`}}));throw t(`API響應狀態: ${l.status} ${l.statusText}`),t(`API錯誤響應: ${JSON.stringify(I,null,2)}`),new Error(`API 錯誤: ${l.status} - ${((h=I.error)==null?void 0:h.message)||l.statusText}`)}t("接收到 API 響應");const f=await l.json();return t(`API返回內容: ${JSON.stringify(f,null,2)}`),f.choices[0].message.content}catch(l){throw t(`API 調用失敗: ${l.message}`),l}}function u(e){return{auto:"自動檢測","zh-TW":"繁體中文","zh-CN":"簡體中文",en:"英文",ja:"日文",ko:"韓文",fr:"法文",de:"德文",es:"西班牙文",it:"義大利文",ru:"俄文",vi:"越南文",th:"泰文",id:"印尼文",ms:"馬來文",fil:"菲律賓文",my:"緬甸文",km:"柬埔寨文",lo:"寮國文",hi:"印地文",bn:"孟加拉文",ta:"泰米爾文",ur:"烏爾都文",ne:"尼泊爾文",si:"僧伽羅文",pt:"葡萄牙文",nl:"荷蘭文",sv:"瑞典文",da:"丹麥文",no:"挪威文",fi:"芬蘭文",is:"冰島文",pl:"波蘭文",uk:"烏克蘭文",cs:"捷克文",hu:"匈牙利文",ro:"羅馬尼亞文",bg:"保加利亞文",sr:"塞爾維亞文",hr:"克羅埃西亞文",sk:"斯洛伐克文",sl:"斯洛維尼亞文",et:"愛沙尼亞文",lv:"拉脫維亞文",lt:"立陶宛文",be:"白俄羅斯文",ar:"阿拉伯文",he:"希伯來文",fa:"波斯文",tr:"土耳其文",az:"亞塞拜然文",ka:"喬治亞文",hy:"亞美尼亞文",am:"阿姆哈拉文",sw:"斯瓦希里文",yo:"約魯巴文",zu:"祖魯文",af:"南非荷蘭文",ha:"豪薩文",ig:"伊博文",mi:"毛利文",haw:"夏威夷文",sm:"薩摩亞文",to:"湯加文",qu:"克丘亞文",ay:"艾馬拉文",gn:"瓜拉尼文",mn:"蒙古文"}[e]||e}function K(){document.getElementById("largeDisplay").style.display="block",t("顯示大尺寸翻譯結果")}function N(){document.getElementById("largeDisplay").style.display="none",t("隱藏大尺寸翻譯結果")}function D(){document.getElementById("addPhraseForm").style.display="block"}function L(){document.getElementById("addPhraseForm").style.display="none",document.getElementById("phraseTitle").value="",document.getElementById("phraseContent").value=""}async function _(){if(!d){alert("請先登入");return}const e=document.getElementById("phraseTitle").value.trim(),n=document.getElementById("phraseContent").value.trim();if(!e||!n){alert("請填寫片語標題和內容");return}try{await g.collection("users").doc(d.uid).collection("phrases").add({title:e,content:n,createdAt:firebase.firestore.FieldValue.serverTimestamp()}),t("片語儲存成功"),L(),$()}catch(o){t(`片語儲存失敗: ${o.message}`),alert(`儲存失敗: ${o.message}`)}}async function $(){if(d)try{const e=await g.collection("users").doc(d.uid).collection("phrases").orderBy("createdAt","desc").get(),n=document.getElementById("phrasesList");if(n.innerHTML="",e.empty){n.innerHTML="<p>尚無儲存的片語</p>";return}e.forEach(o=>{const s=o.data(),a=document.createElement("div");a.className="phrase-item",a.textContent=s.title,a.title=s.content,a.addEventListener("click",()=>{document.getElementById("inputText").value=s.content,t(`使用片語: ${s.title}`)}),n.appendChild(a)}),t("片語加載成功")}catch(e){t(`片語加載失敗: ${e.message}`)}}function q(){let e=localStorage.getItem("openrouter_api_key");if(e)return t("從本地存儲加載 API Key"),e;if(e=prompt("請輸入您的 OpenRouter API Key:"),e&&e.trim()!=="")return localStorage.setItem("openrouter_api_key",e.trim()),t("API Key 已儲存到本地存儲"),e.trim();throw t("錯誤: 未提供 API Key"),new Error("未提供 OpenRouter API Key")}
